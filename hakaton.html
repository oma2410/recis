<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NASA Weather ‚Äî –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–≥–æ–¥—ã –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg:#03041c; --glass: rgba(255,255,255,0.06);
      --accent:#00d0ff; --accent-2:#8b5cff; --text:#e7f0ff;
      --error: #ff4d7a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Roboto,system-ui,Arial; color:var(--text);
      background: radial-gradient(ellipse at bottom, #0b1026 0%, #03041c 50%), linear-gradient(180deg,#00102166,transparent);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px 20px;
      background-attachment: fixed;
    }
    .card{
      width:100%; max-width:900px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); 
      border-radius:18px; padding:22px; box-shadow: 0 10px 30px rgba(2,6,23,0.7);
      border:1px solid rgba(255,255,255,0.04);
      display:grid; grid-template-columns: 1fr 360px; gap:20px; align-items:start;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: radial-gradient(circle at center, transparent 40%, rgba(0, 208, 255, 0.05) 50%, transparent 60%);
      opacity: 0.3;
      transform: rotate(30deg);
      pointer-events: none;
    }
    header{grid-column:1/-1; display:flex; align-items:center; gap:14px; position: relative; z-index: 2;}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700}
    .logo span{font-size:20px;color:#021126}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;opacity:0.8;font-size:13px}

    .search-container {
      position: relative;
      width: 100%;
      margin-top: 12px;
    }
    
    .controls{display:flex;gap:8px; width: 100%;}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:10px;border:0;background:var(--glass);color:var(--text);outline:none; transition: all 0.3s ease;}
    input[type="text"]:focus {box-shadow: 0 0 0 2px var(--accent);}
    button{padding:10px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021126;font-weight:600;cursor:pointer; transition: all 0.2s ease;}
    button:hover {transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
    button.ghost:hover {background: rgba(255, 255, 255, 0.05);}

    .autocomplete {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(10, 15, 40, 0.95);
      border-radius: 0 0 10px 10px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      margin-top: 2px;
      display: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .autocomplete-item {
      padding: 10px 15px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
    }
    .autocomplete-item:hover {
      background: rgba(0, 208, 255, 0.1);
    }
    .autocomplete-item .country {
      opacity: 0.7;
      font-size: 12px;
    }

    .main{
      padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:12px;
      min-height:260px; display:flex;flex-direction:column;justify-content:center;align-items:flex-start;gap:10px;
      position: relative;
      z-index: 2;
    }
    .temp{font-size:54px;font-weight:700;line-height:1}
    .meta{display:flex;gap:12px;font-size:14px;opacity:0.9}

    .side{
      padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:12px;min-height:260px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;
      position: relative;
      z-index: 2;
    }
    .icon{width:120px;height:120px;border-radius:12px;background:linear-gradient(135deg,#00112233,#11104444);display:flex;align-items:center;justify-content:center;font-size:48px}
    .details{width:100%;display:flex;flex-direction:column;gap:6px}
    .row{display:flex;justify-content:space-between;font-size:14px}

    footer.small{grid-column:1/-1;text-align:center;font-size:12px;opacity:0.6;margin-top:8px; position: relative; z-index: 2;}

    .loading {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(3, 4, 28, 0.8);
      border-radius: 18px;
      z-index: 10;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-text {
      font-size: 14px;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--error);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .kyrgyzstan-regions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .region-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }
    .region-btn:hover {
      background: rgba(0, 208, 255, 0.1);
      transform: translateY(-1px);
    }

    /* small screens */
    @media (max-width:820px){
      .card{grid-template-columns:1fr;}
      .side{order: -1}
      .temp{font-size:44px}
      .controls {flex-direction: column;}
    }

    @media (max-width:480px){
      body {padding: 15px;}
      .card {padding: 15px;}
      header {flex-direction: column; text-align: center;}
      .logo {margin-bottom: 10px;}
      .kyrgyzstan-regions {
        justify-content: center;
      }
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="card" role="application">
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text" id="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
    </div>

    <header>
      <div class="logo" aria-hidden><span>NS</span></div>
      <div style="flex: 1;">
        <h1>NASA Weather ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–≥–æ–¥—É –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É</h1>
        <p class="lead">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é ‚Äî –¥–∞–Ω–Ω—ã–µ –∏–∑ Open‚ÄëMeteo (–±–µ–∑ API‚Äë–∫–ª—é—á–∞).</p>
        
        <div class="search-container">
          <div class="controls">
            <input id="city" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Bishkek, London, New York" autocomplete="off" />
            <button id="search"><i class="fas fa-search"></i></button>
            <button id="gps" class="ghost" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"><i class="fas fa-location-arrow"></i></button>
          </div>
          <div class="autocomplete" id="autocomplete"></div>
          
          <div class="kyrgyzstan-regions">
            <div class="region-btn" data-city="–ë–∏—à–∫–µ–∫">–ë–∏—à–∫–µ–∫</div>
            <div class="region-btn" data-city="–û—à">–û—à</div>
            <div class="region-btn" data-city="–î–∂–∞–ª–∞–ª-–ê–±–∞–¥">–î–∂–∞–ª–∞–ª-–ê–±–∞–¥</div>
            <div class="region-btn" data-city="–ë–∞—Ç–∫–µ–Ω">–ë–∞—Ç–∫–µ–Ω</div>
            <div class="region-btn" data-city="–ù–∞—Ä—ã–Ω">–ù–∞—Ä—ã–Ω</div>
            <div class="region-btn" data-city="–¢–∞–ª–∞—Å">–¢–∞–ª–∞—Å</div>
            <div class="region-btn" data-city="–ö–∞—Ä–∞–∫–æ–ª">–ö–∞—Ä–∞–∫–æ–ª</div>
          </div>
        </div>
      </div>
    </header>

    <section class="main" aria-live="polite">
      <div id="place">‚Äî</div>
      <div class="temp" id="temp">‚Äî¬∞C</div>
      <div class="meta"><div id="desc">‚Äî</div><div id="time">‚Äî</div></div>
      <div style="height:8px"></div>
      <div class="details">
        <div class="row"><span>–í–µ—Ç–µ—Ä</span><span id="wind">‚Äî –º/—Å</span></div>
        <div class="row"><span>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span><span id="winddir">‚Äî</span></div>
        <div class="row"><span>–î–∞–≤–ª–µ–Ω–∏–µ</span><span id="press">‚Äî hPa</span></div>
      </div>
    </section>

    <aside class="side">
      <div class="icon" id="icon">ü™ê</div>
      <div style="width:100%">
        <div class="row"><strong>–û—Å–∞–¥–∫–∏</strong><span id="precip">‚Äî</span></div>
        <div class="row"><strong>–í–ª–∞–∂–Ω–æ—Å—Ç—å</strong><span id="humidity">‚Äî</span></div>
        <div class="row"><strong>UV –∏–Ω–¥–µ–∫—Å</strong><span id="uv">‚Äî</span></div>
        <div class="row"><strong>–í–∏–¥–∏–º–æ—Å—Ç—å</strong><span id="visibility">‚Äî km</span></div>
        <div class="row"><strong>–ò—Å—Ç–æ—á–Ω–∏–∫</strong><span>Open‚ÄëMeteo</span></div>
      </div>
    </aside>

    <footer class="small">–î–µ–º–æ: NASA-themed UI. –ö–æ–¥ –æ—Ç–∫—Ä—ã—Ç ‚Äî –º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å. –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.</footer>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const $ = id => document.getElementById(id);
    const searchBtn = $('search');
    const gpsBtn = $('gps');
    const cityInput = $('city');
    const autocomplete = $('autocomplete');
    const loading = $('loading');
    const loadingText = $('loading-text');
    const toast = $('toast');
    const regionButtons = document.querySelectorAll('.region-btn');

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showToast(message, isError = true) {
      toast.textContent = message;
      toast.style.background = isError ? 'var(--error)' : 'var(--accent)';
      toast.style.opacity = '1';
      
      setTimeout(() => {
        toast.style.opacity = '0';
      }, 3000);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
    function setLoading(visible, text = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...') {
      loadingText.textContent = text;
      loading.style.display = visible ? 'flex' : 'none';
    }

    // –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤
    let autocompleteTimeout;
    cityInput.addEventListener('input', function() {
      const value = this.value.trim();
      
      if (value.length < 2) {
        autocomplete.style.display = 'none';
        return;
      }
      
      clearTimeout(autocompleteTimeout);
      autocompleteTimeout = setTimeout(() => {
        fetchAutocomplete(value);
      }, 300);
    });

    cityInput.addEventListener('focus', function() {
      if (autocomplete.innerHTML !== '' && this.value.trim().length >= 2) {
        autocomplete.style.display = 'block';
      }
    });

    document.addEventListener('click', function(e) {
      if (!autocomplete.contains(e.target) && e.target !== cityInput) {
        autocomplete.style.display = 'none';
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–±–ª–∞—Å—Ç–µ–π –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞
    regionButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const cityName = btn.getAttribute('data-city');
        cityInput.value = cityName;
        queryByName(cityName);
      });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ –ª–∞—Ç–∏–Ω–∏—Ü—É
    function transliterateToLatin(text) {
      const cyrillicToLatinMap = {
        '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'yo', '–∂': 'zh',
        '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n', '–æ': 'o',
        '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts',
        '—á': 'ch', '—à': 'sh', '—â': 'sch', '—ä': '', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu',
        '—è': 'ya',
        '–ê': 'A', '–ë': 'B', '–í': 'V', '–ì': 'G', '–î': 'D', '–ï': 'E', '–Å': 'Yo', '–ñ': 'Zh',
        '–ó': 'Z', '–ò': 'I', '–ô': 'Y', '–ö': 'K', '–õ': 'L', '–ú': 'M', '–ù': 'N', '–û': 'O',
        '–ü': 'P', '–†': 'R', '–°': 'S', '–¢': 'T', '–£': 'U', '–§': 'F', '–•': 'H', '–¶': 'Ts',
        '–ß': 'Ch', '–®': 'Sh', '–©': 'Sch', '–™': '', '–´': 'Y', '–¨': '', '–≠': 'E', '–Æ': 'Yu',
        '–Ø': 'Ya'
      };
      
      return text.split('').map(char => {
        return cyrillicToLatinMap[char] || char;
      }).join('');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ –≤–≤–æ–¥–∞
    function detectInputLanguage(text) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ç–µ–∫—Å—Ç –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã
      const cyrillicPattern = /[\u0400-\u04FF]/;
      return cyrillicPattern.test(text) ? 'cyrillic' : 'latin';
    }

    async function fetchAutocomplete(query) {
      try {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –≤–≤–æ–¥–∞
        const inputLanguage = detectInputLanguage(query);
        
        // –ï—Å–ª–∏ –≤–≤–æ–¥ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ, —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∏—Ä—É–µ–º –¥–ª—è –ø–æ–∏—Å–∫–∞
        const searchQuery = inputLanguage === 'cyrillic' ? transliterateToLatin(query) : query;
        
        const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(searchQuery)}&count=10&language=ru`);
        const data = await response.json();
        
        if (!data.results || data.results.length === 0) {
          autocomplete.style.display = 'none';
          return;
        }
        
        autocomplete.innerHTML = '';
        data.results.forEach(city => {
          const item = document.createElement('div');
          item.className = 'autocomplete-item';
          item.innerHTML = `
            <span>${city.name}</span>
            <span class="country">${city.country || ''} ${city.admin1 ? ', ' + city.admin1 : ''}</span>
          `;
          
          item.addEventListener('click', () => {
            cityInput.value = city.name;
            autocomplete.style.display = 'none';
            queryByName(city.name, city.latitude, city.longitude, `${city.name}${city.country ? ', ' + city.country : ''}`);
          });
          
          autocomplete.appendChild(item);
        });
        
        autocomplete.style.display = 'block';
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è:', error);
        autocomplete.style.display = 'none';
      }
    }

    searchBtn.addEventListener('click', () => queryByName(cityInput.value.trim()));
    cityInput.addEventListener('keydown', e => { 
      if (e.key === 'Enter') queryByName(cityInput.value.trim());
    });
    
    gpsBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        showToast('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
        return;
      }
      
      setLoading(true, '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...');
      navigator.geolocation.getCurrentPosition(
        p => fetchWeather(p.coords.latitude, p.coords.longitude, '–¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'), 
        err => {
          setLoading(false);
          showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é: ' + err.message);
        }
      );
    });

    async function queryByName(name, lat = null, lon = null, placeName = null) {
      if (!name && !lat) {
        showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
        return;
      }
      
      setLoading(true, '–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞...');
      
      try {
        if (lat && lon) {
          // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
          fetchWeather(lat, lon, placeName);
        } else {
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –≤–≤–æ–¥–∞ –∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
          const inputLanguage = detectInputLanguage(name);
          const searchName = inputLanguage === 'cyrillic' ? transliterateToLatin(name) : name;
          
          // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
          const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(searchName)}&count=5&language=ru`)
            .then(r => r.json());
          
          if (!geo.results || geo.results.length === 0) {
            setLoading(false);
            showToast('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
          }
          
          const res = geo.results[0];
          fetchWeather(res.latitude, res.longitude, `${res.name}${res.country ? ', ' + res.country : ''}`);
        }
      } catch (e) {
        setLoading(false);
        showToast('–û—à–∏–±–∫–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è');
        console.error(e);
      }
    }

    async function fetchWeather(lat, lon, placeName = '') {
      setLoading(true, '–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã...');
      
      try {
        // –ü–æ–ª—É—á–∞–µ–º –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m,pressure_msl,precipitation,visibility&daily=uv_index_max&timezone=auto`;
        const data = await fetch(url).then(r => r.json());
        
        if (!data || !data.current_weather) {
          setLoading(false);
          showToast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ');
          return;
        }

        const cw = data.current_weather;
        const temp = cw.temperature;
        const wind = cw.windspeed;
        const winddir = cw.winddirection;
        const time = cw.time;

        // –ü–æ–ª—É—á–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        let humidity = '‚Äî', pressure = '‚Äî', precip = '‚Äî', visibility = '‚Äî', uv = '‚Äî';
        
        if (data.hourly) {
          const tIndex = data.hourly.time ? data.hourly.time.indexOf(time) : -1;
          if (tIndex >= 0) {
            if (data.hourly.relativehumidity_2m) humidity = data.hourly.relativehumidity_2m[tIndex] + ' %';
            if (data.hourly.pressure_msl) pressure = data.hourly.pressure_msl[tIndex] + ' hPa';
            if (data.hourly.precipitation) precip = data.hourly.precipitation[tIndex] + ' mm';
            if (data.hourly.visibility) visibility = (data.hourly.visibility[tIndex] / 1000).toFixed(1) + ' km';
          }
        }
        
        if (data.daily && data.daily.uv_index_max && data.daily.time) {
          const today = new Date().toISOString().split('T')[0];
          const todayIndex = data.daily.time.indexOf(today);
          if (todayIndex >= 0) {
            uv = data.daily.uv_index_max[todayIndex];
          }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        $('place').textContent = placeName || `${lat.toFixed(2)}, ${lon.toFixed(2)}`;
        $('temp').textContent = Math.round(temp) + '¬∞C';
        const desc = weatherCodeToText(cw.weathercode);
        $('desc').textContent = desc;
        $('time').textContent = new Date(time).toLocaleString('ru-RU');
        $('wind').textContent = wind + ' –º/—Å';
        $('winddir').textContent = Math.round(winddir) + '¬∞';
        $('press').textContent = pressure;
        $('precip').textContent = precip;
        $('humidity').textContent = humidity;
        $('uv').textContent = uv;
        $('visibility').textContent = visibility;
        $('icon').textContent = weatherCodeToIcon(cw.weathercode);
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        const elements = document.querySelectorAll('#place, #temp, #desc, #time, #wind, #winddir, #press, #precip, #humidity, #uv, #visibility, #icon');
        elements.forEach(el => {
          el.classList.remove('fade-in');
          setTimeout(() => el.classList.add('fade-in'), 10);
        });
        
        setLoading(false);
      } catch (e) {
        console.error(e);
        setLoading(false);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–≥–æ–¥—ã');
      }
    }

    function setStatus(text) {
      $('place').textContent = text;
      $('temp').textContent = '‚Äî¬∞C';
      $('desc').textContent = '';
      $('time').textContent = '';
      $('wind').textContent = '‚Äî';
      $('winddir').textContent = '‚Äî';
      $('press').textContent = '‚Äî';
      $('precip').textContent = '‚Äî';
      $('humidity').textContent = '‚Äî';
      $('uv').textContent = '‚Äî';
      $('visibility').textContent = '‚Äî';
      $('icon').textContent = 'ü™ê';
    }

    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
    function weatherCodeToText(code) {
      const map = {
        0: '–Ø—Å–Ω–æ', 
        1: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ', 
        2: '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å', 
        3: '–ü–∞—Å–º—É—Ä–Ω–æ',
        45: '–¢—É–º–∞–Ω', 
        48: '–¢—É–º–∞–Ω —Å –∏–Ω–µ–µ–º',
        51: '–õ–µ–≥–∫–∞—è –º–æ—Ä–æ—Å—å', 
        53: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å', 
        55: '–ü–ª–æ—Ç–Ω–∞—è –º–æ—Ä–æ—Å—å',
        56: '–õ–µ–≥–∫–∞—è –ª–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å', 
        57: '–ü–ª–æ—Ç–Ω–∞—è –ª–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å',
        61: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å', 
        63: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å', 
        65: '–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å',
        66: '–õ–µ–≥–∫–∏–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å', 
        67: '–°–∏–ª—å–Ω—ã–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å',
        71: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥', 
        73: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥', 
        75: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥',
        77: '–°–Ω–µ–∂–Ω—ã–µ –∑–µ—Ä–Ω–∞',
        80: '–õ–µ–≥–∫–∏–µ –ª–∏–≤–Ω–∏', 
        81: '–£–º–µ—Ä–µ–Ω–Ω—ã–µ –ª–∏–≤–Ω–∏', 
        82: '–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–∏',
        85: '–°–Ω–µ–∂–Ω—ã–µ –ª–∏–≤–Ω–∏', 
        86: '–°–∏–ª—å–Ω—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –ª–∏–≤–Ω–∏',
        95: '–ì—Ä–æ–∑–∞', 
        96: '–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º', 
        99: '–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º'
      };
      return map[code] || ('–ö–æ–¥ –ø–æ–≥–æ–¥—ã: ' + code);
    }

    function weatherCodeToIcon(code) {
      if (code === 0) return '‚òÄÔ∏è';
      if (code <= 3) return '‚õÖ';
      if ([45, 48].includes(code)) return 'üå´Ô∏è';
      if ([51, 53, 55, 56, 57, 61, 63, 65, 66, 67, 80, 81, 82].includes(code)) return 'üåßÔ∏è';
      if ([71, 73, 75, 77, 85, 86].includes(code)) return '‚ùÑÔ∏è';
      if ([95, 96, 99].includes(code)) return '‚õàÔ∏è';
      return 'ü™ê';
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –≤ localStorage
    function saveLastCity(city) {
      localStorage.setItem('lastCity', city);
    }
    
    function getLastCity() {
      return localStorage.getItem('lastCity');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    window.addEventListener('DOMContentLoaded', () => {
      const lastCity = getLastCity();
      if (lastCity) {
        cityInput.value = lastCity;
        queryByName(lastCity);
      } else {
        // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –ë–∏—à–∫–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        queryByName('Bishkek');
      }
    });
  </script>
</body>
</html>